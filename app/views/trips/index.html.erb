<% if active_season %>

    <% if user_signed_in? %>
        <div id="cart">
            <%= render "layouts/cart" %>
        </div>
    <% end %>
    
    <div>
        <%= image_tag "/images/bus-font.jpg", class: "image-cover" %>
    </div>

    <div>
        <h1 class="title-box text-center">
            Travel with MagicBus
        </h1>
    </div>
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 220"><path fill="#ffd700" fill-opacity="1" d="M0,160L60,133.3C120,107,240,53,360,42.7C480,32,600,64,720,96C840,128,960,160,1080,165.3C1200,171,1320,149,1380,138.7L1440,128L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>

    <div class="container-fluid text-center" style="background-color: #ffd700;">

            <h3>Plan & chose your future trips with us!</h3>
            <br>
            
        <div class="container-fluid">
            <div class="mx-auto" id="bus-map"></div>
        </div>

    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 280"><path fill="#ffd700" fill-opacity="1" d="M0,64L60,96C120,128,240,192,360,224C480,256,600,256,720,224C840,192,960,128,1080,101.3C1200,75,1320,85,1380,90.7L1440,96L1440,0L1380,0C1320,0,1200,0,1080,0C960,0,840,0,720,0C600,0,480,0,360,0C240,0,120,0,60,0L0,0Z"></path></svg>
    
    <div class="container-fluid">
        <div class="row justify-content-center text-center">

            <div class="col-sm-3 border rounded shadow-sm mx-2 my-2 p-3" id="dates-sort">
                <%= render "trips/dates_sort" %>
            </div>
            
            <div class="my-auto small yellow">OR</div>
            
            <div class="col-sm-3 border rounded shadow-sm mx-2 my-2 p-3">
                <p>Sort by Country</p>
                <%= select :country, :select, @countries_list.map {|v| [ v ] }, {}, class: "form-control rounded border my-5" %>
            </div>

            <div class="my-auto small yellow">OR</div>

            <div class="col-sm-3 border rounded shadow-sm mx-2 my-2 p-3">
                <p>Sort by Theme</p>
                <%= select :theme, :select, @thematics_list.map {|v| [ v ] }, {}, class: "form-control rounded border my-5" %>
            </div>

        </div>

        <div class="text-center">
            <button id="date-reset" class="btn btn-stylised shadow-sm my-3">Reset Fields</button>
        </div>

    </div>

    <div class="container-fluid trips" id="trips-sort">
        <%= render partial: "trips", locals: {trips: @trips} %>
    </div>

    <% else %>

    <h1>No travels programmed yet. Please come back later!</h1>

<% end %>

<% provide :head_tags do %>
    <meta name='turbolinks-visit-control' content='reload'>
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            initMap();
        });
    </script>
<% end %> 

<script>    
    var trips = [
        <% @trips.each do |trip| %>
            {id: "<%= trip.id %>", week: "<%= trip.week %>", departure: "<%= departure_city(trip) %> <%= departure_country(trip) %>", arrival: "<%= arrival_city(trip) %>", name: "<%= trip.name %>"},
        <% end %>
    ]
</script>

<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>

<script>
$(document).ready(function() {
  $('#country_select').change(function() {
    $('#theme_select').val('All');
    $.ajax({ url: '/travel/sort-trips-country/' + this.value });
  });
});

$(document).ready(function() {
  $('#theme_select').change(function() {
    $('#country_select').val('All');
    $.ajax({ url: '/travel/sort-trips-theme/' + this.value });
  });
});

$("#date-reset").click(function() {
    $('#theme_select').val('All');
    $('#country_select').val('All');
    $.ajax({ url: '/travel/sort-trips-date/reset'  });

});
</script>



