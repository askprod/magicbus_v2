$('#login-form').html("<%= escape_javascript(render :partial => 'layouts/stripe_payment', :locals => {:order => @order}) %>").hide().fadeIn();

$(document).ready(function() {
    const form = document.querySelector("#payment-form")
        if (form == null) { return }

    const stripe = Stripe("pk_test_EBkoqYHCFkUVadPJ5yrPUOte00bP1U7Lyo");
    const elements = stripe.elements()
    
    const elementStyles = {
      base: {
        iconColor: '#666EE8',
        color: '#31325F',
        lineHeight: '40px',
        fontWeight: 400,
        fontFamily: 'Helvetica Neue',
        fontSize: '15px',

        '::placeholder': {
          color: '#CFD7E0',
        },
      },
    }

    const card = elements.create('cardNumber', {
      style: elementStyles,
    })
    card.mount('#card-number')

    const cardExpiry = elements.create('cardExpiry', {
      style: elementStyles,
    });
    cardExpiry.mount('#card-expiry');

    const cardCvc = elements.create('cardCvc', {
      style: elementStyles,
    });
    cardCvc.mount('#card-cvc');

    card.addEventListener("change", (event) => {
        var displayError = document.getElementById('card-errors')
        if (event.error) {
            displayError.textContent = event.error.message
        } else {
            displayError.textContent = ''
        }
    })

    form.addEventListener("submit", (event) => {
    event.preventDefault()

    let data = {
      payment_method: {
        card: card,
        billing_details: {
          name: form.querySelector("#name-card").value
        }
      }
    }

    stripe.confirmCardPayment(form.dataset.paymentIntentId, data).then((result) => {
      if (result.error) {
        var errorElement = document.getElementById('card-errors')
        errorElement.textContent = result.error.message
        errorElement.style.display = "block"
      } else {
        // 
        // 
        form.submit()
      }
    })
  })
})