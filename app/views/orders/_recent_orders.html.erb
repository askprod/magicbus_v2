<% @recent_orders.each do |order| %>

<div class="row justify-content-center my-5">
    <div class="card col-9 m-1 px-0 py-4 border-0 shadow-sm my-2" style="background:#ffe475;">
      <div class="row no-gutters my-auto">
        <div class="col-9">
          <h4 class="mb-0 ml-4 adventpro font-weight-bold">Travellers Information</h4>
        </div>
      </div>
    </div>
</div>

<%= render "orders/travellers", order: order %>

<div class="row justify-content-center my-5">
    <div class="card col-9 m-1 px-0 py-4 border-0 shadow-sm my-2" style="background:#ffe475;">
      <div class="row no-gutters my-auto">
        <div class="col-9">
          <h4 class="mb-0 ml-4 adventpro font-weight-bold">Trips Information</h4>
        </div>
      </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-9 my-auto">       
        <% order.trips.each do |trip| %>
            <%= render "orders/trip", trip: trip %>
        <% end %>
    </div>
</div>

<div class="container smaller-padding my-5">
    <%= render "orders/trips_specifications" %>
</div>

<div class="row justify-content-center my-5">
    <div class="card col-9 m-1 px-0 py-4 border-0 shadow-sm my-2" style="background:#ffe475;">
      <div class="row no-gutters my-auto">
        <div class="col-9">
          <h4 class="mb-0 ml-4 adventpro font-weight-bold">Payment Information</h4>
        </div>
      </div>
    </div>
</div>

<div class="container smaller-padding mt-5">
    <%= render "price_specifications", order: order %>
</div>

<% if order.coupon %>
    <div>Current Code: <%= order.coupon.code %>
    <div><%= order.coupon.reduction_percentage %>% Reduction</div>
<% else %>
    <div class="container-fluid my-1 text-center">
        <%= link_to order_promo_code_path(order), class: "btn btn-stylised", remote: true do %>
            <p class="small my-auto">PROMO CODE</p>
        <% end %>
    </div>
<% end %>

<div class="my-4">
    <h4 class="text-center">Total TTC: <span class="mx-3"><%= order.total_price %>€</span></h4>
</div>

<div class="container smallest-padding" id="order-checkboxes">
    <div class="form-check">
        <%= check_box_tag :order_first_checkbox, class:"form-check-input" %>
        <%= label_tag :order_first_checkbox, class:"form-check-label" do %>
            <p>En cochant cette case, pour moi-même ainsi que pour le compte des autres voyageurs inscrits, je certifie:</p>
            <ul>
                <li>
                    <p>Avoir pris connaissance - avant le paiement – de l’offre répondant aux exigences de l’article R. 211-4 du Code du Tourisme, des conditions particulières de vente de voyages et du formulaire standard d’information,</p>
                </li>
                <li>
                    <p>Avoir pris connaissance des informations liées à la situation politique et sanitaire de la destination choisie figurant dans la rubrique conseils-aux-voyageurs du site <a href="https://www.diplomatie.gouv.fr/fr/conseils-aux-voyageurs/" target="_blank" class="pdf-btn">https://www.diplomatie.gouv.fr/fr/conseils-aux-voyageurs/</a> (plus spécifiquement concernant les sous rubriques « risque pays » et « santé ») à consulter régulièrement jusqu’au départ,</p>
                </li>
                <li>
                    <p>Avoir pris connaissance de la brochure et du programme de l’organisateur,</p>
                </li>
                <li>
                    <p>Avoir pris connaissance des conditions de garantie des assurances souscrites,</p>
                </li>
            </ul>
        <% end %>
    </div>
    <div class="form-check">
        <%= check_box_tag :order_second_checkbox, class:"form-check-input" %>
        <%= label_tag :order_second_checkbox, class:"form-check-label" do %>
            <p>En cochant cette case, la personne accepte de <a href="#" class="pdf-btn">transmettre ses données</a> dans le but de son exécution et garantit qu’il a recueilli le consentement des autres voyageurs aux mêmes fins.</p>
        <% end %>
    </div>
    <div class="form-check">
        <%= check_box_tag :order_third_checkbox, class:"form-check-input" %>
        <%= label_tag :order_third_checkbox, class:"form-check-label" do %>
            <p>En cochant cette case, je reconnais avoir lu et accepté les <a href="#" target="_blank" class="pdf-btn">conditions générales de vente</a>.</p>
        <% end %>
    </div>
</div>

<div class="text-center">
    <div class="btn btn-danger no-p-margin mt-3" id="stripe-alert" style="display: none;">
        <p>Veuillez cocher les cases ci-dessus avant de procéder au paiement.</p>
    </div>
</div>

<div class="mt-5 text-center" id="stripe-div">
    <%= link_to order_new_payment_path(order), class:"btn btn-lg btn-gradient shadow-sm disabled", id: "stripe-payment-btn", remote: true do %>
        <h5 class="mb-0 p-1 adventpro" id="stripe-text">Passer au Paiement</h5>
        <%= image_tag("/images/logo_stripe.png", class:"img-fluid", size: "150x150") %>
    <% end %>
</div>

<% end %>

<script>
$(document).ready(function(){
    var stripeBtn = $("#stripe-payment-btn");
    var stripeAlert = $("#stripe-alert");
    var stripeDiv = $("#stripe-div");
    stripeBtn.prop("disabled", true)

    $('#order-checkboxes input[type=checkbox]').change(function(){ 
        if ($('#order-checkboxes input[type=checkbox]:checked').length == 3) {
            stripeBtn.prop("disabled", false)
            stripeBtn.removeClass('disabled');
            stripeAlert.hide();
        } else {
            stripeBtn.prop("disabled", true)
            stripeBtn.addClass('disabled');
        }
    });

    stripeDiv.click(function(){
        if (stripeBtn.hasClass('disabled')) {
            stripeAlert.show();
        }
    });
});
</script>












